<% if (clients && clients.length > 0) { %>
<!--======  Start Client/Partner Section  ======-->
<section class="renvia-partner-section pt-80 pb-80">
    <div class="container">
        <div class="row align-items-center mb-40">
            <div class="col-lg-6">
                <div class="section-title text-center text-lg-start">
                    <span class="sub-title" data-aos="fade-down" data-aos-duration="1000">
                        <img src="assets/images/line1.png" alt="line">Our Partners
                    </span>
                    <h2 class="text-anm">Trusted by Leading Companies</h2>
                </div>
            </div>
            <div class="col-lg-6">
                <!-- Navigation Arrows -->
                <div class="client-slider-nav text-lg-end text-center">
                    <button class="client-nav-btn client-prev" id="clientPrev">
                        <i class="far fa-arrow-left"></i>
                    </button>
                    <button class="client-nav-btn client-next" id="clientNext">
                        <i class="far fa-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Client Logo Slider -->
        <div class="client-slider-container" data-aos="fade-up" data-aos-duration="1000">
            <div class="client-slider-wrapper" id="clientSlider">
                <% clients.forEach((client) => { %>
                    <div class="client-logo-item">
                        <a href="<%= client.link || '#' %>" target="_blank" rel="noopener noreferrer">
                            <div class="client-logo-inner">
                                <img src="<%= process.env.S3_BASE_URL + client.logo %>" 
                                     alt="<%= client.name || 'Client Logo' %>"
                                     title="<%= client.name || 'Client' %>">
                            </div>
                        </a>
                    </div>
                <% }) %>
            </div>
        </div>

        <!-- Pagination Dots (optional, for carousel mode) -->
        <div class="client-dots" id="clientDots"></div>
    </div>
</section>

<style>
    /* Partner Section */
    .renvia-partner-section {
        background-color: #f8f9fa;
        overflow: hidden;
    }

    /* Navigation Buttons */
    .client-slider-nav {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
        align-items: center;
    }

    .client-nav-btn {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        border: 2px solid var(--border-color, #e0e0e0);
        background-color: var(--white-color, #ffffff);
        color: var(--heading-color, #1a1a1a);
        font-size: 18px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .client-nav-btn:hover {
        background-color: var(--primary-color, #e33d5c);
        border-color: var(--primary-color, #e33d5c);
        color: var(--white-color, #ffffff);
        transform: scale(1.1);
    }

    .client-nav-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    /* Slider Container */
    .client-slider-container {
        position: relative;
        overflow: hidden;
        margin: 0 -15px;
    }

    .client-slider-wrapper {
        display: flex;
        transition: transform 0.5s ease-in-out;
        cursor: grab;
    }

    .client-slider-wrapper:active {
        cursor: grabbing;
    }

    /* Client Logo Items */
    .client-logo-item {
        flex: 0 0 calc(25% - 30px);
        min-width: calc(25% - 30px);
        padding: 15px;
        box-sizing: border-box;
    }

    .client-logo-inner {
        background-color: var(--white-color, #ffffff);
        border-radius: 12px;
        padding: 30px 20px;
        height: 120px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .client-logo-inner:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
    }

    .client-logo-inner::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.8), transparent);
        transition: left 0.5s ease;
    }

    .client-logo-inner:hover::before {
        left: 100%;
    }

    .client-logo-inner img {
        max-width: 100%;
        max-height: 80px;
        object-fit: contain;
        transition: all 0.3s ease;
        filter: grayscale(100%);
        opacity: 0.7;
    }

    .client-logo-inner:hover img {
        filter: grayscale(0%);
        opacity: 1;
    }

    .client-logo-item a {
        display: block;
        text-decoration: none;
    }

    /* Pagination Dots */
    .client-dots {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 40px;
    }

    .client-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background-color: #d0d0d0;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .client-dot.active {
        background-color: var(--primary-color, #e33d5c);
        width: 30px;
        border-radius: 5px;
    }

    .client-dot:hover {
        background-color: var(--primary-color, #e33d5c);
    }

    /* Responsive Design */
    @media (max-width: 1199px) {
        .client-logo-item {
            flex: 0 0 calc(33.333% - 30px);
            min-width: calc(33.333% - 30px);
        }
    }

    @media (max-width: 991px) {
        .client-logo-item {
            flex: 0 0 calc(50% - 30px);
            min-width: calc(50% - 30px);
        }
    }

    @media (max-width: 767px) {
        .client-logo-item {
            flex: 0 0 calc(50% - 30px);
            min-width: calc(50% - 30px);
        }

        .client-logo-inner {
            padding: 20px 15px;
            height: 100px;
        }

        .client-logo-inner img {
            max-height: 60px;
        }
    }

    @media (max-width: 575px) {
        .client-logo-item {
            flex: 0 0 calc(100% - 30px);
            min-width: calc(100% - 30px);
        }

        .section-title {
            text-align: center !important;
        }

        .client-slider-nav {
            justify-content: center;
            margin-top: 20px;
        }

        .client-logo-inner {
            padding: 25px;
            height: 110px;
        }

        .client-logo-inner img {
            max-height: 70px;
        }
    }

    /* Hide dots when not needed (<= 4 items on desktop) */
    .client-dots.hidden {
        display: none;
    }

    /* Touch Swipe Indicator */
    @media (hover: none) and (pointer: coarse) {
        .client-slider-wrapper {
            cursor: grab;
        }

        .client-slider-wrapper:active {
            cursor: grabbing;
        }
    }
</style>

<script>
(function() {
    const slider = document.getElementById('clientSlider');
    const prevBtn = document.getElementById('clientPrev');
    const nextBtn = document.getElementById('clientNext');
    const dotsContainer = document.getElementById('clientDots');

    if (!slider) return;

    const items = slider.querySelectorAll('.client-logo-item');
    const totalItems = items.length;

    // Determine items per view based on screen size
    const getItemsPerView = () => {
        const width = window.innerWidth;
        if (width <= 575) return 1;
        if (width <= 767) return 2;
        if (width <= 991) return 2;
        if (width <= 1199) return 3;
        return 4;
    };

    let itemsPerView = getItemsPerView();
    let currentIndex = 0;
    let isDragging = false;
    let startPos = 0;
    let currentTranslate = 0;
    let prevTranslate = 0;
    let animationID = 0;

    // Calculate maximum slide index
    const maxIndex = Math.max(0, totalItems - itemsPerView);

    // Update UI state
    const updateUI = () => {
        // Update button states
        prevBtn.disabled = currentIndex <= 0;
        nextBtn.disabled = currentIndex >= maxIndex;

        // Update dots
        if (totalItems > itemsPerView) {
            dotsContainer.classList.remove('hidden');
            dotsContainer.innerHTML = '';
            const totalPages = maxIndex + 1;
            
            for (let i = 0; i < totalPages; i++) {
                const dot = document.createElement('div');
                dot.className = 'client-dot' + (i === currentIndex ? ' active' : '');
                dot.addEventListener('click', () => goToSlide(i));
                dotsContainer.appendChild(dot);
            }
        } else {
            dotsContainer.classList.add('hidden');
        }

        // Update slider position
        const slideWidth = 100 / itemsPerView;
        currentTranslate = -(currentIndex * slideWidth);
        slider.style.transform = `translateX(${currentTranslate}%)`;
    };

    // Go to specific slide
    const goToSlide = (index) => {
        currentIndex = Math.max(0, Math.min(index, maxIndex));
        updateUI();
    };

    // Navigate to next slide
    const nextSlide = () => {
        goToSlide(currentIndex + 1);
    };

    // Navigate to previous slide
    const prevSlide = () => {
        goToSlide(currentIndex - 1);
    };

    // Touch/Mouse event handlers
    const touchStart = (index) => {
        return function(event) {
            isDragging = true;
            startPos = getPositionX(event);
            animationID = requestAnimationFrame(animation);
            slider.style.transition = 'none';
        }
    };

    const touchEnd = () => {
        isDragging = false;
        cancelAnimationFrame(animationID);

        const movedBy = currentTranslate - prevTranslate;

        // Snap to nearest slide
        if (movedBy < -5) {
            nextSlide();
        } else if (movedBy > 5) {
            prevSlide();
        } else {
            goToSlide(currentIndex);
        }

        slider.style.transition = 'transform 0.5s ease-in-out';
    };

    const touchMove = (event) => {
        if (isDragging) {
            const currentPosition = getPositionX(event);
            const diff = currentPosition - startPos;
            
            const slideWidth = 100 / itemsPerView;
            currentTranslate = prevTranslate + (diff / slider.offsetWidth) * 100 * itemsPerView / totalItems * 10;
            
            slider.style.transform = `translateX(${currentTranslate}%)`;
        }
    };

    const getPositionX = (event) => {
        return event.type.includes('mouse') ? event.pageX : event.touches[0].clientX;
    };

    const animation = () => {
        if (isDragging) requestAnimationFrame(animation);
    };

    // Bind events
    prevBtn.addEventListener('click', prevSlide);
    nextBtn.addEventListener('click', nextSlide);

    // Touch events for mobile swipe
    slider.addEventListener('touchstart', touchStart(currentIndex), { passive: true });
    slider.addEventListener('touchend', touchEnd);
    slider.addEventListener('touchmove', touchMove, { passive: true });

    // Mouse events for desktop drag
    slider.addEventListener('mousedown', touchStart(currentIndex));
    slider.addEventListener('mouseup', touchEnd);
    slider.addEventListener('mouseleave', () => {
        if (isDragging) touchEnd();
    });
    slider.addEventListener('mousemove', touchMove);

    // Handle window resize
    window.addEventListener('resize', () => {
        const newItemsPerView = getItemsPerView();
        if (newItemsPerView !== itemsPerView) {
            itemsPerView = newItemsPerView;
            currentIndex = 0;
            prevTranslate = 0;
            updateUI();
        }
    });

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft') {
            prevSlide();
        } else if (e.key === 'ArrowRight') {
            nextSlide();
        }
    });

    // Initialize
    updateUI();
})();
</script>
<% } %>
