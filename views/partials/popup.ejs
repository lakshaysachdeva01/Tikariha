<!-- Property Media Popup Component -->
<div class="pm-popup">
    <div class="pm-popup-content">
        <!-- Close Button -->
        <span class="pm-close">&times;</span>

        <div class="pm-inner-content">
            <!-- Media Container (Image or Video) -->
            <div class="pm-media-container">
                <img src="" alt="" class="pm-image" style="display: none;">
                <iframe src="" frameborder="0" allowfullscreen class="pm-video" style="display: none;" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                        allowfullscreen></iframe>
            </div>
            <div class="pm-counter">
                <span class="pm-current">1</span> of <span class="pm-total">n</span>
            </div>
        </div>
        <!-- Navigation Buttons -->
        <button class="pm-nav pm-prev">&#10094;</button>
        <button class="pm-nav pm-next">&#10095;</button>
    </div>
</div>

<!-- Property Media Popup Styles -->
<style>
    /* Popup Overlay */
    .pm-popup {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        z-index: 99999;
        justify-content: center;
        align-items: center;
    }

    .pm-popup.pm-open {
        display: flex;
    }

    .pm-inner-content{
        border-radius: 10px;
        overflow: hidden;
        text-align: center;
        position: relative;
        background: #000; /* Add background for better video visibility */
    }
    /* Popup Content */
    .pm-popup-content {
        max-width: 90%;
        max-height: 90%;
        border-radius: 10px;
        overflow: hidden;
        text-align: center;
        background: #000;
    }

    /* Media Container */
    .pm-media-container {
        position: relative;
        width: 100%;
        height: 600px;
        display: flex;
        justify-content: center;
        align-items: center;
        background: #000;
    }

    .pm-image,
    .pm-video {
        max-width: 100%;
        height: 600px;
        display: none;
        margin: 0 auto;
    }

    .pm-image {
        object-fit: contain;
        background: #000;
    }

    .pm-video {
        width: 1000px;
        height: 600px;
        border: none;
        background: #000;
    }

    /* Close Button */
    .pm-close {
        position: absolute;
        top: 10px;
        right: 10px;
        font-size: 24px;
        color: #fff;
        cursor: pointer;
        background: rgba(0, 0, 0, 0.5);
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1001;
    }

    /* Data Count */
    .pm-counter {
        font-size: 14px;
        color: #fff;
        text-align: right;
        padding: 8px 15px;
        border-radius: 20px;
        z-index: 1001;
        background: rgba(0, 0, 0, 0.5);
        position: absolute;
        top: 10px;
        left: 10px;
    }

    /* Navigation Buttons */
    .pm-nav {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        border: none;
        font-size: 22px;
        cursor: pointer;
        padding: 10px;
        color: #fff;
        background: rgba(0, 0, 0, 0.5);
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1001;
    }

    .pm-nav:hover {
        background: rgba(34, 34, 34, 0.753);
    }

    .pm-prev {
        left: 10px;
    }

    .pm-next {
        right: 10px;
    }

    /* Responsive Adjustments */
    @media (max-width: 800px) {
        .pm-popup-content {
            max-width: 95%;
            max-height: 90%;
        }
    
        .pm-inner-content{
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        
        .pm-media-container {
            width: 100%;
            height: 400px;
        }
    
        .pm-image,
        .pm-video {
            width: 100%;
            height: auto;
            max-height: 400px;
        }
    
        .pm-video {
            width: 100%;
            height: 300px;
        }
    }
</style>

<!-- Property Media Popup JavaScript -->
<script>
    // Property Media Popup Module
    const propertyMediaPopup = (function() {
        // DOM Elements
        const popup = document.querySelector('.pm-popup');
        const closeBtn = document.querySelector('.pm-close');
        const imageEl = document.querySelector('.pm-image');
        const videoEl = document.querySelector('.pm-video');
        const prevBtn = document.querySelector('.pm-prev');
        const nextBtn = document.querySelector('.pm-next');
        const currentEl = document.querySelector('.pm-current');
        const totalEl = document.querySelector('.pm-total');
        
        // State
        let currentIndex = 0;
        let mediaItems = [];
        
        // Helper function to extract YouTube ID from various URL formats
        function getYouTubeId(url) {
            if (!url) return null;
            
            const patterns = [
                /(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([a-zA-Z0-9_-]+)/,
                /youtube\.com\/v\/([a-zA-Z0-9_-]+)/,
                /youtube\.com\/watch\?.*v=([a-zA-Z0-9_-]+)/,
                /youtu\.be\/([a-zA-Z0-9_-]+)/
            ];
            
            for (const pattern of patterns) {
                const match = url.match(pattern);
                if (match && match[1]) {
                    return match[1];
                }
            }
            
            return null;
        }
        
        // Helper function to create YouTube embed URL
        function createYouTubeEmbedUrl(videoId) {
            if (!videoId) return null;
            return `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0&modestbranding=1&showinfo=0&controls=1`;
        }
        
        // Public API
        const api = {
            // Show popup at specific index
            show: function(startIndex = 0) {
                const triggers = document.querySelectorAll('.property-media-trigger');
                
                if (triggers.length > 0 && startIndex >= 0 && startIndex < triggers.length) {
                    // Trigger click on the specific trigger
                    triggers[startIndex].click();
                } else if (triggers.length > 0) {
                    triggers[0].click();
                }
            },
            
            // Initialize the popup
            init: function() {
                this._setupMediaItems();
                this._setupEventListeners();
            }
        };
        
        // Private methods
        api._setupMediaItems = function() {
            const triggers = document.querySelectorAll('.property-media-trigger');
            mediaItems = [];
            
            triggers.forEach((trigger) => {
                const type = trigger.getAttribute('data-type');
                let src = trigger.getAttribute('data-src');
                
                // Process video URLs to get embed URL
                if (type === 'video') {
                    const videoId = getYouTubeId(src);
                    if (videoId) {
                        src = createYouTubeEmbedUrl(videoId);
                    }
                }
                
                mediaItems.push({ 
                    type, 
                    src, 
                    originalSrc: trigger.getAttribute('data-src'),
                    element: trigger 
                });
                
                // Add click event to trigger
                trigger.addEventListener('click', (e) => {
                    e.preventDefault();
                    const index = mediaItems.findIndex(item => item.element === trigger);
                    api._open(index);
                });
            });
            
            totalEl.textContent = mediaItems.length;
        };
        
        api._open = function(index) {
            currentIndex = index;
            api._updateDisplay();
            popup.classList.add('pm-open');
            document.body.style.overflow = 'hidden';
        };
        
        api._close = function() {
            // Stop video playback
            if (videoEl.style.display === 'block') {
                // For iframe videos (like YouTube)
                if (videoEl.tagName === 'IFRAME') {
                    videoEl.src = ''; // Clear src to stop video
                }
            }
            
            popup.classList.remove('pm-open');
            imageEl.style.display = 'none';
            videoEl.style.display = 'none';
            imageEl.src = '';
            videoEl.src = '';
            document.body.style.overflow = '';
        };
        
        api._updateDisplay = function() {
            const media = mediaItems[currentIndex];
            if (!media) return;
            
            if (media.type === 'image') {
                imageEl.src = media.src;
                imageEl.style.display = 'block';
                videoEl.style.display = 'none';
                videoEl.src = ''; // Clear video src
            } else if (media.type === 'video') {
                // Set iframe src with embed URL
                videoEl.src = media.src;
                videoEl.style.display = 'block';
                imageEl.style.display = 'none';
                imageEl.src = ''; // Clear image src
            }
            
            currentEl.textContent = currentIndex + 1;
        };
        
        api._next = function() {
            // Stop current video
            if (videoEl.style.display === 'block') {
                videoEl.src = '';
            }
            
            currentIndex = (currentIndex + 1) % mediaItems.length;
            api._updateDisplay();
        };
        
        api._prev = function() {
            // Stop current video
            if (videoEl.style.display === 'block') {
                videoEl.src = '';
            }
            
            currentIndex = (currentIndex - 1 + mediaItems.length) % mediaItems.length;
            api._updateDisplay();
        };
        
        api._setupEventListeners = function() {
            // Close button
            closeBtn.addEventListener('click', () => api._close());
            
            // Navigation buttons
            nextBtn.addEventListener('click', () => api._next());
            prevBtn.addEventListener('click', () => api._prev());
            
            // Close on background click
            popup.addEventListener('click', (e) => {
                if (e.target === popup) {
                    api._close();
                }
            });
            
            // Keyboard navigation
            document.addEventListener('keydown', (e) => {
                if (popup.classList.contains('pm-open')) {
                    if (['ArrowUp', 'ArrowDown', 'PageUp', 'PageDown', 'Home', 'End', ' '].includes(e.key)) {
                        e.preventDefault();
                    }
                    
                    if (e.key === 'ArrowRight') api._next();
                    else if (e.key === 'ArrowLeft') api._prev();
                    else if (e.key === 'Escape') api._close();
                }
            });
            
            // Prevent wheel scrolling when popup is open
            document.addEventListener('wheel', (e) => {
                if (popup.classList.contains('pm-open')) {
                    e.preventDefault();
                }
            }, { passive: false });
        };
        
        return api;
    })();
    
    // Initialize when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
        propertyMediaPopup.init();
    });
</script>